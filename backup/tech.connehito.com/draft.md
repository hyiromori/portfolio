# Flow to TypeScript


---

# Memo

## 前提

前提として、可能な限りいじらない、いじるなら TS 化してしまう、という方針を立てた。

## Webpack の設定

## Flow のスタブ

`import ... '*.ts'` にするとスタブファイルを参照して Flow のチェックをスキップするようにした。

## Cypress によるスクショ比較

一旦は型定義がきちんとできなくても動いていれば正義、という方向にしました。
Chrome のみですが、スクショレベルで１ピクセルでもズレていればCIで落ちるようになっているので、UIのリグレッションや、そもそもなにかのミスで表示ができないというようなケースを（CIの実行時間はかかりますが）コストを掛けずにできるようになりました。

Safari でもテストをしたく、TestCafe も使ってみたんですが、うまく動かせない場合があり原因が特定できず一旦諦めてしまいました。

## ESLint の解消

https://github.com/Connehito/mamari-q-app-webview/pull/2358

## JS (Flow) → TS の移行

- Flow の型定義と合わない部分もある
- `// @flow` の定義漏れなどで、型定義があっていない場合もある
- 一つ一つファイルを見て変えていくほうが、既存の定義をある程度生かして移行できるのでよいと判断
- 具体的な数は記録していなかったのですが、個別対応しないと行けなささそうな箇所が数百ぐらいあり、それを一度に修正するのは現実的ではない。
- かつ、一定数区切るのであれば機械的にやるよりも、手でやった方が作業的に流行りやすそう、という結論になった。
