---
title: "公開鍵基盤 (PKI)"
---

公開鍵暗号を利用した証明書を使い、通信相手の認証を行い、通信における信頼を成り立たせる仕組み。
正当な通信相手であることを認証するために、認証局 (CA) から発行された証明書を使用する。
認証局 (CA) が PKI における重要な役割を果たしている。

例として `https://example.com` にアクセスした場合、通信相手が確かに `https://example.com` であることを認証できる。
(`https://example.com` にアクセスしているつもりが、実は `https://evil.example` にアクセスしていた、ということにはならない)

あくまで通信相手が想定している相手であることが確認できるだけで、例にあげた `https://example.com` が悪意のないサイトであるかどうかなどは確認できない。


## 証明書

証明書には、認証のレベルに応じた以下の3種類がある。

- EV 証明書 (Extended validation)
- OV 証明書 (Organization validation)
- DV 証明書 (Domain Validation)

### EV 証明書 (Extended validation)

サイトを運営する組織が実在し、申請していることが確認できた場合に発行される証明書。
従来は、アドレスバーが緑色になり企業名などが表示されるといったメリットが存在したが、現在はなくなっている。

- [アドレスバーに会社名を表示できる「EV SSL証明書」とは | さくらのSSL](https://ssl.sakura.ad.jp/column/ev-ssl/)
- [SSL証明書のブラウザアドレスバー表示を知りたい | さくらのサポート情報](https://help.sakura.ad.jp/ssl/2345/)

### OV 証明書 (Organization validation)

DV証明書と同様に、サイトを運営する組織が実在し、申請していることが確認できた場合に発行される証明書。
DV証明書に比べ、手続きや検証が簡略化されており、標準化されていない。
というより、OV証明書が先に存在したが、その標準化されていない状況に対してより厳格で一貫性のある方法を求められて、EV証明書が作られたよう。

[筆者感想]
現在では積極的に使われなさそうに思えた。

### DV 証明書 (Domain Validation)

ドメインを保有していることが確認できた場合に発行される証明書。
3種類の中で最も簡素な方法で、手続きも自動化されている。


## 証明書の形式

証明書では「X.509 デジタル公開鍵証明書形式」という形式が使用されており、これがヒョウンになっている。
[X.500 ディレクトリシリーズ](https://ja.wikipedia.org/wiki/X.500) の一つで、ISO/IEC の国際標準として規定されている。

### フィールド

証明書には以下の情報が含まれている。

- Version (バージョン)
- Serial Number (シリアル番号)
- Signature Algorithm (署名アルゴリズム)
- Issuer (発行者)
- Validity (有効性)
- Subject (主体者)
- Public key (公開鍵)

また、上記の他に拡張することも可能になっている。


## ルート証明書

信頼できる通信相手であるかどうかは、証明書に署名しているCAの証明書をたどり、最終的にルート証明書に到達するかどうかで検証している。

ルート証明書は、信頼できるCAが署名した証明書である前提で登録されている。
そのため、悪意のある証明書をルート証明書に登録すると、悪意ある相手を信頼してしまうため、ルート証明書の登録は注意が必要。


## CA (Certification Authority, 認証局)

CAは、証明書を発行する機関である。

その中でも、特に他の認証局から認証を受けず、自分で自分を認証する認証局をルート認証局と呼び、ルート認証局が発行する自らの証明書をルート証明書と呼ぶ。
ルート認証局以外の認証局は中間認証局と呼ぶ。

CAが侵略された場合、公開鍵基盤全体のセキュリティが失われてしまう。
そのため、認証局は特に高いセキュリティを求められる。
証明書の発行・管理に関する基本要件をまとめた [Baseline Requirement](https://cabforum.org/baseline-requirements-documents/) というものが存在する。

証明書は、有料で発行するケースが多かったが、現在は [Let's Encrypt](https://letsencrypt.org/) などの無料で(DV)証明書が発行できる CA も存在する。


## 証明書の失効

証明書が何らかの侵害を受けた場合に、失効するための手段が用意されている。
失効の方法は、以下の２つの標準がある。

- CRL (Certificate Revocation List)
- OCSP (Online Certificate Status Protocol)

### CRL (Certificate Revocation List)

失効した証明書のシリアル番号を全て一覧にしたもの。
欠点としては、リストが肥大化することで配布や検索が重くなってしまう。

### OCSP (Online Certificate Status Protocol)

単一の証明書の失効状態を証明書利用者が取得できるようにするプロトコル。
証明書のシリアル番号などで、都度オンラインで問い合わせることで失効状態を取得できる。


## PKI の弱点

PKI は完璧なシステムではなく、いくつもの弱点を抱えている。
ここでは「プロフェッショナルSSL/TLS 第３章 公開鍵基盤」の見出し部分だけ抜粋する。
（詳細は書籍を確認）

- 証明書の発行に際してドメイン所有者の許可が求められない
- 信頼を迅速に復旧できない
- 弱いドメインの検証
- 失効がうまくいかない
- 証明書の警告がセキュリティの意図を台無しにする

## 余談

[ロシアが自国のウェブサイトの信頼を独自に担保するTLS認証局を設置 - GIGAZINE](https://gigazine.net/news/20220311-russia-certificate-authority/)
