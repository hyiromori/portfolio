---
title: "公開鍵暗号"
---

公開鍵暗号は、秘密鍵と公開鍵という２つの鍵を使い、どちらかの鍵で暗号化したデータは、反対の鍵でしか複合できないという特性を持つ暗号方式。

例えば、公開鍵で暗号化したデータは秘密鍵でしか複合できない。
これにより、安全でない通信経路であっても、秘密鍵の所有者に安全にデータを受け渡すことができる。

また、秘密鍵で暗号化したデータは、公開鍵でしか複合できない。
これにより秘密鍵の所有者が送信した (改ざんされていない) データであることを確認できる。

欠点としては、共通鍵暗号に比べて暗号化・復号の速度が遅さがある。
そのため共通鍵暗号で使う秘密鍵を協会鍵暗号方式でやりとりし、実際のデータは共通鍵暗号で暗号化するというように、両方を組み合わせて使う場合もある。

公開鍵暗号の方式は様々あり、代表的なものとしては RSA や楕円曲線暗号等がある。

## RSA

> RSA暗号（RSAあんごう）とは、桁数が大きい合成数の素因数分解が現実的な時間内で困難であることを安全性の根拠とした公開鍵暗号の一つである。
> 
> https://ja.wikipedia.org/wiki/RSA%E6%9A%97%E5%8F%B7

現在広く普及している公開鍵暗号の方式。

## 楕円曲線 (ECC)

> 楕円曲線上の離散対数問題 (EC-DLP) の困難性を安全性の根拠とする暗号。
> 
> https://ja.wikipedia.org/wiki/%E6%A5%95%E5%86%86%E6%9B%B2%E7%B7%9A%E6%9A%97%E5%8F%B7

楕円曲線を利用した暗号方式の総称で、具体的な暗号方式としてはDSAを楕円曲線上で定義した楕円曲線DSA (ECDSA) などがある。

## ディフィー・ヘルマン鍵交換

> 事前の秘密の共有無しに、盗聴の可能性のある通信路を使って、暗号鍵の共有を可能にする、公開鍵暗号方式の暗号プロトコルである。この鍵は、共通鍵暗号の鍵として使用可能である。
> 
> https://ja.wikipedia.org/wiki/%E3%83%87%E3%82%A3%E3%83%95%E3%82%A3%E3%83%BC%E3%83%BB%E3%83%98%E3%83%AB%E3%83%9E%E3%83%B3%E9%8D%B5%E5%85%B1%E6%9C%89

「徹底解剖 TLS 1.3 P62」にあるこの図が分かりやすい。

![ディフィー・ヘルマン鍵交換の流れ](https://mryhryki.com/file/UhYb1IxPP9c6nIGJfzN_TZKLGAZoe7pgd_28yRhHsd40HYz0.jpeg)

### ディフィー・ヘルマン鍵交換のサンプルプログラム (JavaScript)

上記の図を元に (大きな桁の数を扱いやすい) Ruby で簡単なサンプルプログラムを作ってみた。
最終的に、やり取りしていない `30` という数値が双方で算出できることがわかる。

```ruby
puts "G: #{G = 39}"
puts "P: #{P = 51}"
puts "A: #{A = 43}"
puts "B: #{B = 76}"
puts ""

puts "Pa: (G[#{G}] ** A[#{A}]) % P[#{P}] = #{Pa = (G ** A) % P}"
puts "Pb: (G[#{G}] ** B[#{B}]) % P[#{P}] = #{Pb = (G ** B) % P}"
puts ""

puts "(Pb[#{Pb}] ** A[#{A}]) % P[#{P}] = #{(Pb ** A) % P}"
puts "(Pa[#{Pa}] ** B[#{B}]) % P[#{P}] = #{(Pa ** B) % P}"
```

```
$ ruby dh.rb 
G: 39
P: 51
A: 43
B: 76

Pa: (G[39] ** A[43]) % P[51] = 45
Pb: (G[39] ** B[76]) % P[51] = 21

(Pb[21] ** A[43]) % P[51] = 30
(Pa[45] ** B[76]) % P[51] = 30
```
