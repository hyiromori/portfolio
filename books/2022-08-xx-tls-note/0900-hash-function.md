---
title: "ハッシュ関数"
---

ハッシュ関数は任意のデータから、固定長の出力を出力するアルゴリズムのことを指す。

例えば以下のような文章のハッシュ値を例に考えてみる。

```text
あのイーハトーヴォのすきとおった風、夏でも底に冷たさをもつ青いそら、うつくしい森で飾られたモリーオ市、郊外のぎらぎらひかる草の波。
```

この文章を MD5 というアルゴリズムで計算すると、以下のような出力が得られる。

```text
7863f16deea16ea0425275938f0f3d32
```

次に、上記の文章の最後に改行コード（ASCIIコード値: `10`）を追加すると以下のような出浴が得られる。

```text
547a91535b80f8782ec24617cea09ecb
```

データの長さに関わらず一定の長さの値が得られ、内容のごく一部が変わるだけでも値が大きく変わるのが特徴。



## ハッシュ関数に求められる性質

以下の３つがある。

- 現像計算困難性 (Preimage resistance)
- 第２現像計算困難性 (Second preimage resistance)
- 衝突耐性 (Collision resistance)

### 現像計算困難性 (Preimage resistance)

ハッシュ関数を通じて得られた値から、元のデータを特定することが困難である性質を指す。

### 第２現像計算困難性 (Second preimage resistance)

あるデータからハッシュ関数を通じて出力される値があり、それと同じ値が出力されるデータを特定することが困難である性質を指す。

ハッシュ関数はデータの改ざんの検出にも使われるため、同一のハッシュ値になるデータが容易に特定されると、改ざん検知に使うことが難しい。

### 衝突耐性 (Collision resistance)

同じハッシュ値が得られる２つの異なるデータを特定することが困難である性質を指す。

### おまけ: Bitcoin の論文内での記載

ビットコインのいわゆるマイニングも、ハッシュ関数の性質が使われている。
"4. Proof-of-Work" の章で書かれている。

[bitcoin.pdf](https://bitcoin.org/bitcoin.pdf)

現像計算困難性を逆に活用し、先頭のnビット (参加しているノードの計算力よって変動するらしい) が `0` になるように `nonce` を探すことから、マイニング (採掘) と呼ばれている。



## ハッシュ関数の代表例

- MD5
- SHA-1
- SHA-2
- SHA-3

### MD5

> 1991年に考案されたアルゴリズムで、IETFによってRFC 1321として標準化された。近年では同一のハッシュ値を持つ異なる原文のペアを効率よく探索することなどができるようになり、セキュリティ用途でMD5を使用するのは十分安全とは言えなくなっている。
> https://e-words.jp/w/MD5.html

### SHA-1

> SHA-1はNSA（米国家安全保障局）が考案し、1995年にNIST（米国標準技術局）によって連邦情報処理標準の一つ（FIPS 180-1）として標準化された。2005年頃から効率的に攻撃する手法がいくつか発見され十分な安全性が保たれなくなったため、近年では2001年に制定された後継のSHA-2規格への移行が進んでいる。
> https://e-words.jp/w/SHA-1.html

余談だが Git では SHA1 が使われている。

### SHA-2

> SHA-2はNSA（米国家安全保障局）が考案し、2001年にNIST（米国標準技術局）によって連邦情報処理標準の一つ（FIPS 180-4）として標準化された。SHA-224、SHA-256、SHA-384、SHA-512の4つをまとめた総称で、これらの末尾の数字がそれぞれのハッシュ値のビット長を表している。最長のSHA-512が最も安全性が高く、一般的にはSHA-256が最もよく利用されている。
> https://e-words.jp/w/SHA-2.html

### SHA-3

> SHA-3はSHA-2の後継規格を定めるべくNIST（米国標準技術局）が暗号学者らに公募したもので、応募された方式の中から「Keccak」（キャチャックあるいはケチャックと読む）が選ばれ、2015年に連邦情報処理標準「FIPS 202」として公式に発表された。
>
> 2020年代初頭の状況ではSHA-1に対する現実的な攻撃手法が考案され、SHA-1の廃止とSHA-2への移行が急がれている。SHA-2に対する効率的な攻撃手法は未だ報告されておらず、SHA-3への移行を急ぐ必要は無いが、主要な暗号通信ソフトウェアや通信プロトコル規格などがSHA-3対応仕様の追加などを進めており、使用可能な環境が整いつつある。
> 
> https://e-words.jp/w/SHA-3.html

## MAC (Message Authentication Code, メッセージ認証コード)

MAC はメッセージを認証するためのコード（短い情報）を生成するためのアルゴリズム、またはそのアルゴリズムを使用して生成されたコード。
任意のメッセージと共通鍵から生成する。

MAC では共通の鍵が使われるため、事前に鍵交換が必要になる。
また、共通鍵が使われているため、偽造されたメッセージであるかどうかは検証できない。
（メッセージが完全なものであることは検証できるが、共通鍵を手に入れれば誰でもコードを生成できるため）

### HMAC (Hash-based Message Authentication Code)

> ハッシュ関数には反復型の暗号学的ハッシュ関数ならば任意のものを利用できる。MD5を用いたものを「HMAC-MD5」、SHA-1を用いたものを「HMAC-SHA1」、SHA-2のSHA-256を用いたものを「HMAC-SHA256」というように呼ぶ。
> https://e-words.jp/w/HMAC.html

ハッシュ関数を使用して MAC の生成を行う方式。
RFC 2104 として公開されている。

#### おまけ: JWT での活用例

JWT の署名で HMAC が使用されることもある。

> JWTs can be signed using a secret (with the HMAC algorithm) or ...
> https://jwt.io/introduction

## 参考リンク

- [暗号学におけるハッシュの要件(衝突耐性、原像計算困難性、第二原像計算困難性) - Qiita](https://qiita.com/Da_0801/items/bfa7b66bc88ccb0d38dd)
