<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simple Video Player</title>
</head>
<body style="position: relative; width: 100vw; height: 100vh; overflow: hidden; margin: 0; background-color: #333;">
  <input
    id="video-file-selector"
    type="file"
    accept="video/*"
    style="position: fixed; bottom: -1px; left: -1px; max-width: 1px; max-height: 1px; overflow: hidden;"
  >
  <div
    id="file-drop-area"
    style="position: absolute; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center;"
  >
    <div style="color: #fff;">
      Drop video file here or
      <button id="select-video-file"
              style="font-size: 1rem; color: #fff; background: none; border: none; padding: 0; margin: 0; text-decoration: underline; cursor: pointer;">
        select video file.
      </button>
    </div>
  </div>
  <div
    id="video-area"
    style="display: none; position: absolute; width: 100vw; height: 100vh; background-color: #000;"
  >
    <div
      id="video-title"
      style="display: none; position: absolute; top: 0; right: 0; background-color: #0005; border-radius: 4px; font-size: 12px; line-height: 1.5; color: #fff; padding: 4px 8px;"
    ></div>
    <video
      id="video-player"
      style="height: 100%; max-width: 100%; object-fit: contain;"
      autoplay
      controls
      loop
    ></video>
  </div>

  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", () => {
      const videoFileSelectorElement = document.getElementById("video-file-selector");
      const selectVideoFileElement = document.getElementById("select-video-file");
      selectVideoFileElement.addEventListener("click", () => videoFileSelectorElement.click());

      const fileDropAreaElement = document.getElementById("file-drop-area");
      const videoAreaElement = document.getElementById("video-area");
      const videoPlayerElement = document.getElementById("video-player");
      videoPlayerElement.addEventListener("focus", () => videoPlayerElement.blur());

      loadVideoUrlByQueryParam(videoAreaElement, videoPlayerElement);
      setVideoFileHandling(videoFileSelectorElement, fileDropAreaElement, videoAreaElement, videoPlayerElement);
      setKeyboardShortcut(videoAreaElement, videoPlayerElement);
    });
  </script>

  <script type="text/javascript">
    const setVideoFileHandling = (videoFileSelectorElement, fileDropAreaElement, videoAreaElement, videoPlayerElement) => {
      const onVideoFileSelected = (videoFile) => {
        if (videoFile != null && videoFile.type.startsWith("video/")) {
          const videoUrl = URL.createObjectURL(videoFile);
          showVideo(videoAreaElement, videoPlayerElement, videoUrl);
          showTitle(true, videoFile.name);
        }
      };
      fileDropAreaElement.addEventListener("dragover", (event) => {
        event.stopPropagation();
        event.preventDefault();
      });
      fileDropAreaElement.addEventListener("drop", (event) => {
        event.preventDefault();
        event.stopPropagation();
        onVideoFileSelected(event.dataTransfer.files[0]);
      });
      videoFileSelectorElement.addEventListener("change", (event) => {
        event.preventDefault();
        event.stopPropagation();
        onVideoFileSelected(videoFileSelectorElement.files[0]);
      });
    };
  </script>

  <script type="text/javascript">
    const loadVideoUrlByQueryParam = (videoAreaElement, videoPlayerElement) => {
      const videoUrl = new URL(window.location.href).searchParams.get("url");
      if (videoUrl != null) {
        showVideo(videoAreaElement, videoPlayerElement, videoUrl);
      }
      const videoTitle = new URL(window.location.href).searchParams.get("title");
      if (videoTitle != null) {
        showTitle(true, videoTitle);
      }
    };
  </script>

  <script type="text/javascript">
    const showVideo = (videoAreaElement, videoPlayerElement, videoUrl) => {
      videoAreaElement.style.display = "flex";
      videoPlayerElement.volume = Volume.get();
      videoPlayerElement.src = videoUrl;
    };
  </script>

  <script type="text/javascript">
    const showTitle = (show, title = null) => {
      const element = document.getElementById("video-title");
      if (title != null) element.innerText = title;
      element.style.display = show ? "block" : "none";
    };
  </script>

  <script type="text/javascript">
    const setKeyboardShortcut = (() => {
      let keyboardHandler = null;
      return (videoAreaElement, videoPlayerElement) => {
        if (keyboardHandler != null) {
          window.removeEventListener("keydown", keyboardHandler);
        }
        keyboardHandler = (event) => {
          const { key, metaKey, shiftKey } = event;
          if (key === " ") {
            event.preventDefault();
            if (videoPlayerElement.paused) {
              videoPlayerElement.play().catch(console.error);
            } else {
              videoPlayerElement.pause();
            }
          } else if (key === "f") {
            event.preventDefault();
            if (document.fullscreenElement == null) {
              videoAreaElement.requestFullscreen().catch(console.error);
            } else {
              document.exitFullscreen().catch(console.error);
            }
          } else if (key === "ArrowUp" || key === "ArrowDown") {
            const cv = videoPlayerElement.muted ? 0 : videoPlayerElement.volume * 100;
            if (videoPlayerElement.muted) {
              videoPlayerElement.muted = false;
            }
            const vec = key === "ArrowUp" ? 1 : -1;
            const nextVolume = Math.min(Math.max(cv + (vec * (cv < 1 ? 0.1 : cv < 20 ? 1 : 5)), 0), 100);
            videoPlayerElement.volume = Volume.set(Math.round(nextVolume * 10) * 0.001);
          } else if (key === "ArrowLeft" || key === "ArrowRight") {
            event.preventDefault();
            const vec = key === "ArrowRight" ? 1 : -1;
            const addingSec = Math.max(Math.min(vec * 2 * (shiftKey ? 15 : 1) * (metaKey ? 90 : 1), 600), -600);
            videoPlayerElement.currentTime =
              Math.min(Math.max(0, videoPlayerElement.currentTime + addingSec), videoPlayerElement.duration);
          } else if (!metaKey && ["1", "2", "3", "4", "5", "6", "7", "8", "9", "0"].includes(key)) {
            event.preventDefault();
            videoPlayerElement.currentTime = Math.round(videoPlayerElement.duration * (parseInt(key, 10) || 0) * 0.1);
          } else if (key === "c") {
            event.preventDefault();
            const show = videoPlayerElement.controls;
            videoPlayerElement.controls = !show;
            showTitle(!show);
          } else if (key === "<" || key === ">") {
            event.preventDefault();
            const vec = key === ">" ? 1 : -1;
            const nextRate = videoPlayerElement.playbackRate + (vec * 0.1);
            videoPlayerElement.playbackRate = Math.min(Math.max(nextRate, 0.1), 5);
          } else if (key === ".") {
            event.preventDefault();
            videoPlayerElement.playbackRate = 1;
          }
        };
        window.addEventListener("keydown", keyboardHandler);
      };
    })();
  </script>
  <script>
    class Volume {
      static StorageKey = "video:volume";

      static get() {
        const storageValue = localStorage.getItem(Volume.StorageKey);
        if (typeof (storageValue) === "string") {
          const value = parseFloat(storageValue);
          if (!isNaN(value) && 0 <= value && value <= 1) {
            return value;
          }
        }
        return 0;
      }

      static set(rawVolume) {
        const volume = (!isNaN(rawVolume) && 0 <= rawVolume && rawVolume <= 1) ? rawVolume : 0;
        localStorage.setItem(Volume.StorageKey, String(volume));
        return volume;
      }
    }
  </script>
</body>
</html>
