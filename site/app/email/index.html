<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Email Viewer</title>
    <style>
        :root {
        }
    </style>
</head>
<body>
<div>
    <pre id="json"></pre>
</div>

<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", async () => {
        const emlUrl = new URL(window.location.href).searchParams.get("url")
        if (emlUrl == null) {
            return
        }
        const response = await fetch(emlUrl);
        const emlBuf = await response.text();
        const mail = await globalThis.parseEml(emlBuf);
        console.debug(mail)
        const {headers, body: bodies} = mail;

        const content = {};
        const attachments = [];
        bodies.forEach(({part}) => {
            const {headers, body} = part
            const contentType = (headers["Content-Type"] ?? "unknown/unknown").split(";")[0]
            if (contentType.startsWith("text/")) {
                content[contentType] = body
            } else {
                attachments.push({headers, body})
            }
        })

        const date = headers["Date"] ?? "(Unknown)"
        const subject = headers["Subject"] ?? "(No Subject)"
        const from = headers["From"] ?? "(Unknown)"
        const to = headers["To"] ?? "(Unknown)"
        document.getElementById("json").innerText = JSON.stringify({subject, date, from, to, content, attachments}, null, 2)
    });
</script>
<script src="./eml-parse-js.js"></script>
</body>
</html>
